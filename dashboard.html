<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User Dashboard</title>
  </head>
  <body>
    <h1>Панель пользователя</h1>
    <div id="userInfo"></div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
    <script>
      const supabaseUrl = "https://qkmqzhrosivywepflhtq.supabase.co";
      const supabaseKey =
        "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrbXF6aHJvc2l2eXdlcGZsaHRxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTA3Nzk1NjUsImV4cCI6MjAyNjM1NTU2NX0.8QjJ1W7X0MTS-kPkSr2MzuM3Jjrq8F4H6EYQBEa5a7o";
      const supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);

      // Функция для получения информации о текущем пользователе
      async function fetchUserInfo() {
        // Получаем текущего пользователя
        const user = supabaseClient.auth.user();

        // Если пользователь авторизован
        if (user) {
          try {
            // Загружаем информацию о пользователе из Supabase
            const { data, error } = await supabaseClient
              .from("users")
              .select("*")
              .eq("id", user.id)
              .single();

            // Если удалось загрузить информацию о пользователе
            if (data) {
              // Отображаем информацию о пользователе на странице
              document.getElementById("userInfo").innerHTML = `
              <p>Привет, ${user.email}!</p>
              <p>Ваш ID: ${user.id}</p>
              <p>Ваше имя: ${data.name}</p>
              <!-- Добавьте другие поля здесь по вашему усмотрению -->
            `;
            } else {
              console.error(
                "Ошибка загрузки информации о пользователе:",
                error
              );
            }
          } catch (error) {
            console.error(
              "Ошибка загрузки информации о пользователе:",
              error.message
            );
          }
        } else {
          // Если пользователь не авторизован, перенаправляем на страницу входа
          window.location.href = "index.html";
        }
      }

      // Вызываем функцию получения информации о пользователе при загрузке страницы
      fetchUserInfo();
    </script>
  </body>
</html>
